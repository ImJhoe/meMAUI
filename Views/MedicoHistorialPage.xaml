<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="ClinicaApp.Views.MedicoHistorialPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="{Binding Title}"
             BackgroundColor="#F5F5F5">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">

            <!-- 📋 HEADER -->
            <Frame BackgroundColor="#1976D2" 
                   CornerRadius="10" 
                   Padding="20,15"
                   HasShadow="True">
                <StackLayout Orientation="Horizontal" Spacing="15">
                    <Label Text="👨‍⚕️" FontSize="24"/>
                    <StackLayout>
                        <Label Text="PUNTO 2: Historial de Triaje" 
                               FontSize="18" 
                               FontAttributes="Bold" 
                               TextColor="White"/>
                        <Label Text="Vista del Médico" 
                               FontSize="14" 
                               TextColor="#BBDEFB"/>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- 🔍 SELECCIÓN DE CITA -->
            <Frame BackgroundColor="White" 
                   CornerRadius="10" 
                   Padding="15" 
                   HasShadow="True">
                <StackLayout Spacing="10">
                    <Label Text="📅 Seleccionar Cita con Triaje" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           TextColor="#1976D2"/>

                    <Picker Title="Seleccione una cita"
                            ItemsSource="{Binding CitasConTriaje}"
                            ItemDisplayBinding="{Binding DisplayText}"
                            SelectedItem="{Binding CitaSeleccionada}"
                            BackgroundColor="#F8F9FA"
                            TextColor="#333"/>

                    <!-- INFO PACIENTE -->
                    <StackLayout IsVisible="{Binding MostrarInfoPaciente}" 
                                 Spacing="5">
                        <BoxView HeightRequest="1" BackgroundColor="#E0E0E0"/>
                        <Label Text="{Binding InfoPaciente}" 
                               FontSize="14" 
                               TextColor="#666"
                               Margin="0,5"/>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- 📊 DATOS DEL TRIAJE -->
            <Frame BackgroundColor="White" 
                   CornerRadius="10" 
                   Padding="15" 
                   HasShadow="True"
                   IsVisible="{Binding MostrarTriaje}">
                <StackLayout Spacing="15">
                    <StackLayout Orientation="Horizontal" Spacing="10">
                        <Label Text="📊 Datos del Triaje Registrado" 
                               FontSize="16" 
                               FontAttributes="Bold" 
                               TextColor="#1976D2"
                               HorizontalOptions="FillAndExpand"/>
                        <Label Text="{Binding FechaTriaje, StringFormat='{0:dd/MM/yyyy HH:mm}'}" 
                               FontSize="12" 
                               TextColor="#666"/>
                    </StackLayout>

                    <!-- SIGNOS VITALES -->
                    <Frame BackgroundColor="#E3F2FD" 
                           CornerRadius="8" 
                           Padding="12"
                           HasShadow="False">
                        <StackLayout Spacing="8">
                            <Label Text="🩺 Signos Vitales" 
                                   FontSize="14" 
                                   FontAttributes="Bold" 
                                   TextColor="#1976D2"/>

                            <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="10" RowSpacing="5">
                                <!-- TEMPERATURA -->
                                <Label Grid.Row="0" Grid.Column="0"
                                       Text="{Binding TriajeSeleccionado.Temperatura, StringFormat='🌡️ Temperatura: {0:F1}°C'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <!-- PRESIÓN ARTERIAL -->
                                <Label Grid.Row="0" Grid.Column="1"
                                       Text="{Binding TriajeSeleccionado.PresionArterial, StringFormat='💓 Presión: {0} mmHg'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <!-- FRECUENCIA CARDÍACA -->
                                <Label Grid.Row="1" Grid.Column="0"
                                       Text="{Binding TriajeSeleccionado.FrecuenciaCardiaca, StringFormat='❤️ FC: {0} lpm'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <!-- FRECUENCIA RESPIRATORIA -->
                                <Label Grid.Row="1" Grid.Column="1"
                                       Text="{Binding TriajeSeleccionado.FrecuenciaRespiratoria, StringFormat='🫁 FR: {0} rpm'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <!-- SATURACIÓN OXÍGENO -->
                                <Label Grid.Row="2" Grid.Column="0"
                                       Text="{Binding TriajeSeleccionado.SaturacionOxigeno, StringFormat='🫁 SpO2: {0}%'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <!-- NIVEL URGENCIA -->
                                <Label Grid.Row="2" Grid.Column="1"
                                       Text="{Binding NivelUrgenciaTexto}" 
                                       FontSize="13" 
                                       TextColor="#333"/>
                            </Grid>
                        </StackLayout>
                    </Frame>

                    <!-- MEDIDAS ANTROPOMÉTRICAS -->
                    <Frame BackgroundColor="#E8F5E8" 
                           CornerRadius="8" 
                           Padding="12"
                           HasShadow="False">
                        <StackLayout Spacing="8">
                            <Label Text="📏 Medidas Antropométricas" 
                                   FontSize="14" 
                                   FontAttributes="Bold" 
                                   TextColor="#2E7D32"/>

                            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
                                <Label Grid.Column="0"
                                       Text="{Binding TriajeSeleccionado.Peso, StringFormat='⚖️ Peso: {0:F1} kg'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <Label Grid.Column="1"
                                       Text="{Binding TriajeSeleccionado.Talla, StringFormat='📐 Talla: {0} cm'}" 
                                       FontSize="13" 
                                       TextColor="#333"/>

                                <Label Grid.Column="2"
                                       Text="{Binding TriajeSeleccionado.IMC, StringFormat='📊 IMC: {0:F2}'}" 
                                       FontSize="13" 
                                       FontAttributes="Bold"
                                       TextColor="#2E7D32"/>
                            </Grid>
                        </StackLayout>
                    </Frame>

                    <!-- OBSERVACIONES -->
                    <StackLayout IsVisible="{Binding TieneObservaciones}" Spacing="8">
                        <Label Text="📝 Observaciones del Triaje" 
                               FontSize="14" 
                               FontAttributes="Bold" 
                               TextColor="#1976D2"/>
                        <Frame BackgroundColor="#FFF3E0" 
                               CornerRadius="8" 
                               Padding="12"
                               HasShadow="False">
                            <Label Text="{Binding TriajeSeleccionado.Observaciones}" 
                                   FontSize="13" 
                                   TextColor="#333"/>
                        </Frame>
                    </StackLayout>

                    <!-- ENFERMERO QUE REGISTRÓ -->
                    <StackLayout Orientation="Horizontal" Spacing="5">
                        <Label Text="👨‍⚕️ Registrado por:" 
                               FontSize="12" 
                               TextColor="#666"/>
                        <Label Text="{Binding TriajeSeleccionado.NombreEnfermero}" 
                               FontSize="12" 
                               FontAttributes="Bold"
                               TextColor="#333"/>
                    </StackLayout>
                </StackLayout>
            </Frame>

            <!-- 🎯 ACCIONES DEL MÉDICO - NAVEGACIÓN A PUNTO 3 -->
            <Frame BackgroundColor="White" 
                   CornerRadius="10" 
                   Padding="15" 
                   HasShadow="True"
                   IsVisible="{Binding MostrarTriaje}">
                <StackLayout Spacing="15">
                    <Label Text="🎯 Acciones del Médico" 
                           FontSize="16" 
                           FontAttributes="Bold" 
                           TextColor="#1976D2"/>

                    <Button Text="📋 CONTINUAR A CONSULTA MÉDICA"
                            Command="{Binding IrAConsultaMedicaCommand}"
                            BackgroundColor="#1976D2"
                            TextColor="White"
                            FontSize="16"
                            FontAttributes="Bold"
                            CornerRadius="10"
                            HeightRequest="50"/>

                    <Label Text="💡 En la consulta médica podrá agregar diagnóstico y receta" 
                           FontSize="12" 
                           TextColor="#666"
                           HorizontalTextAlignment="Center"/>
                </StackLayout>
            </Frame>

            <!-- 📊 INDICADOR DE CARGA -->
            <ActivityIndicator IsVisible="{Binding IsBusy}" 
                              IsRunning="{Binding IsBusy}"
                              Color="#1976D2"
                              HeightRequest="50"/>

        </StackLayout>
    </ScrollView>

</ContentPage>
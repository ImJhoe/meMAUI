<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="ClinicaApp.Views.CitasListaPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="{Binding Title}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">

            <!-- HEADER -->
            <Frame BackgroundColor="#E3F2FD" Padding="15" CornerRadius="10">
                <StackLayout>
                    <Label Text="ðŸ“‹ LISTA DE CITAS" 
                           FontSize="20" 
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="#1976D2"/>
                    <Label Text="{Binding MensajeFiltro}"
                           FontSize="14"
                           HorizontalOptions="Center"
                           TextColor="#424242"/>
                </StackLayout>
            </Frame>

            <!-- FILTROS -->
            <Frame BackgroundColor="White" Padding="15" CornerRadius="8" HasShadow="True">
                <StackLayout Spacing="15">
                    <Label Text="ðŸ” FILTROS DE BÃšSQUEDA" FontAttributes="Bold" TextColor="#333"/>

                    <!-- Filtro por fecha -->
                    <StackLayout>
                        <Label Text="ðŸ“… Fecha:" FontSize="14" FontAttributes="Bold"/>
                        <DatePicker Date="{Binding FechaSeleccionada}" 
                                   BackgroundColor="#F5F5F5"
                                   Format="dd/MM/yyyy"/>
                    </StackLayout>

                    <!-- Filtro por mÃ©dico -->
                    <StackLayout>
                        <Label Text="ðŸ‘¨â€âš•ï¸ MÃ©dico:" FontSize="14" FontAttributes="Bold"/>
                        <Picker ItemsSource="{Binding Medicos}"
                               SelectedItem="{Binding MedicoSeleccionado}"
                               ItemDisplayBinding="{Binding Nombre}"
                               BackgroundColor="#F5F5F5"
                               Title="Seleccionar mÃ©dico"/>
                    </StackLayout>

                    <!-- Filtro por estado -->
                    <StackLayout>
                        <Label Text="ðŸ“Š Estado:" FontSize="14" FontAttributes="Bold"/>
                        <Picker ItemsSource="{Binding EstadosDisponibles}"
                               SelectedItem="{Binding EstadoSeleccionado}"
                               BackgroundColor="#F5F5F5"/>
                    </StackLayout>

                    <!-- Botones de filtro -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <Button Grid.Column="0"
                                Text="ðŸ” Buscar" 
                                BackgroundColor="#4CAF50"
                                TextColor="White"
                                Command="{Binding CargarCitasCommand}"/>
                        <Button Grid.Column="1"
                                Text="ðŸ—‘ï¸ Limpiar"
                                BackgroundColor="#FF9800"
                                TextColor="White"
                                Command="{Binding LimpiarFiltrosCommand}"/>
                    </Grid>
                </StackLayout>
            </Frame>

            <!-- CONTADOR DE RESULTADOS -->
            <Frame BackgroundColor="#FFF3E0" Padding="10" CornerRadius="8">
                <Label Text="{Binding TotalCitas, StringFormat='ðŸ“Š Total: {0} citas encontradas'}" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"
                       TextColor="#E65100"/>
            </Frame>

            <!-- LISTA DE CITAS -->
            <Frame BackgroundColor="White" Padding="10" CornerRadius="8" HasShadow="True">
                <StackLayout>
                    <Label Text="Resultados:" FontAttributes="Bold" FontSize="16" Margin="0,0,0,10"/>

                    <CollectionView ItemsSource="{Binding Citas}"
                                   EmptyView="No se encontraron citas con los filtros aplicados">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#FAFAFA" Padding="15" Margin="0,5" CornerRadius="8" HasShadow="False">
                                    <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="*,Auto">

                                        <!-- Fila 1: Paciente y Estado -->
                                        <Label Grid.Row="0" Grid.Column="0" 
                                               Text="{Binding Paciente}" 
                                               FontAttributes="Bold" 
                                               FontSize="16"
                                               TextColor="#333"/>
                                        <Frame Grid.Row="0" Grid.Column="1" 
                                               BackgroundColor="{Binding EstadoColor}"
                                               Padding="8,4" 
                                               CornerRadius="12"
                                               HasShadow="False">
                                            <Label Text="{Binding Estado}" 
                                                   TextColor="White"
                                                   FontSize="12"
                                                   FontAttributes="Bold"/>
                                        </Frame>

                                        <!-- Fila 2: CÃ©dula -->
                                        <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="{Binding CedulaPaciente, StringFormat='ðŸ“‹ CÃ©dula: {0}'}" 
                                               FontSize="14" 
                                               TextColor="#666"/>

                                        <!-- Fila 3: MÃ©dico y Especialidad -->
                                        <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                               Text="{Binding Medico, StringFormat='ðŸ‘¨â€âš•ï¸ {0}'}" 
                                               FontSize="14" 
                                               TextColor="#2196F3"
                                               FontAttributes="Bold"/>

                                        <!-- Fila 4: Fecha, Hora y Sucursal -->
                                        <StackLayout Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" 
                                                    Orientation="Horizontal" 
                                                    Spacing="15">
                                            <Label Text="{Binding FechaTexto, StringFormat='ðŸ“… {0}'}" 
                                                   FontSize="13" 
                                                   TextColor="#333"/>
                                            <Label Text="{Binding Hora, StringFormat='â° {0}'}" 
                                                   FontSize="13" 
                                                   TextColor="#333"
                                                   FontAttributes="Bold"/>
                                            <Label Text="{Binding Sucursal, StringFormat='ðŸ¥ {0}'}" 
                                                   FontSize="13" 
                                                   TextColor="#666"/>
                                        </StackLayout>

                                        <!-- Fila 5: Motivo y botÃ³n detalle -->
                                        <Label Grid.Row="4" Grid.Column="0"
                                               Text="{Binding Motivo, StringFormat='ðŸ“ {0}'}" 
                                               FontSize="13" 
                                               TextColor="#555"
                                               MaxLines="2"/>
                                        <Button Grid.Row="4" Grid.Column="1"
                                               Text="ðŸ‘ï¸ Ver"
                                               BackgroundColor="#2196F3"
                                               TextColor="White"
                                               FontSize="12"
                                               Padding="10,5"
                                               CornerRadius="15"
                                               Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.VerDetalleCitaCommand}"
                                               CommandParameter="{Binding}"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>
            </Frame>

            <!-- BOTONES DE NAVEGACIÃ“N -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                <Button Grid.Column="0"
                        Text="ðŸ”„ Actualizar"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        Command="{Binding CargarCitasCommand}"/>
                <Button Grid.Column="1"
                        Text="ðŸ  Volver al MenÃº"
                        BackgroundColor="#757575"
                        TextColor="White"
                        Command="{Binding VolverAlMenuCommand}"/>
            </Grid>

        </StackLayout>
    </ScrollView>
</ContentPage>